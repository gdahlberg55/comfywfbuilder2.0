# Workflow Layout Standards v2.0

## Overview
This document defines the MANDATORY layout standards for all ComfyUI workflows generated by the Orchestrator v2.0 system.

## Core Layout Principles

### 1. Grid-Based Organization
- **ALL positions snap to 20px grid**
- **No exceptions** - every X and Y coordinate must be divisible by 20
- This ensures clean, professional layouts

### 2. Column-Based Node Layout
Within each group, nodes are organized in columns:
- **Single Column**: Nodes stacked vertically with consistent spacing
- **Multi-Column**: Nodes distributed across columns, each column left-aligned
- **Example**: 6 nodes = 3 columns x 2 rows OR 2 columns x 3 rows

### 3. Hierarchical Spacing System

#### Node-Level Spacing (Within Groups)
```
VERTICAL SPACING BETWEEN NODES:
- Small nodes (50-100px height):    200px Y-distance
- Medium nodes (100-200px height):  250px Y-distance  
- Large nodes (200-400px height):   450px+ Y-distance
- Extra large (400px+ height):      600px+ Y-distance

HORIZONTAL SPACING BETWEEN COLUMNS:
- Minimum: 400px between column starts
- Standard: 430px for most workflows
- Wide: 500px+ for complex nodes
```

#### Group-Level Spacing
```
HORIZONTAL GROUP SPACING:
- Minimum: 100px between group boundaries
- Standard: 400px for clear separation
- Preferred: Match internal column spacing for consistency

VERTICAL GROUP SPACING:
- Single row: Not applicable
- Multi-row: 400px minimum between rows
- Large groups: 500px+ for clarity
```

### 4. Group Alignment Rules

#### Row Alignment
- **All groups in same row MUST have identical Y position**
- Top edges align EXACTLY (not approximately)
- Example: Row 1 groups all start at Y=30

#### Column Consistency
- Groups should maintain consistent widths where logical
- Similar function groups use similar dimensions
- Output groups typically wider for preview space

### 5. Standard Group Positions

#### First Row (Y=30)
```
Group 1: [30, 30, width, height]    # Model Loading
Group 2: [430, 30, width, height]   # LoRA Management  
Group 3: [960, 30, width, height]   # Sampling Controls
Group 4: [1830, 30, width, height]  # Generation
```

#### Second Row (Y=900)
```
Group 5: [30, 900, width, height]   # Prompt Processing
Group 6: [960, 900, width, height]  # Workflow Control
Group 7: [2230, 900, width, height] # Additional Processing
```

### 6. Node Positioning Within Groups

#### Header Clearance
- **First node starts at group.y + 50px minimum**
- Accounts for 30px header + 20px padding
- Example: Group at Y=30, first node at Y=80

#### Left Alignment
```python
# For each column in group:
column_x = group_x + 20 + (column_index * column_spacing)
# All nodes in column use same X coordinate
```

#### Vertical Distribution
```python
# For each node in column:
node_y = group_y + 50 + (node_index * vertical_spacing)
# vertical_spacing based on node heights
```

## Specific Layout Patterns

### Pattern A: Model Loading Chain
```
UNETLoader       -> Y=80
DualCLIPLoader   -> Y=280  (200px gap)
VAELoader        -> Y=500  (220px gap)
ModelSampling    -> Y=680  (180px gap)
```

### Pattern B: Sampling Controls Grid
```
Column 1:                Column 2:
- Latent (Y=80)         - Guider (Y=80)
- Noise (Y=280)         - Scheduler (Y=280)
- Sampler (Y=480)
```

### Pattern C: Generation Pipeline
```
SamplerCustom    -> Y=80  (large node)
VAEDecode        -> Y=560 (480px gap for large node)
```

## Validation Checklist

### Node-Level Validation
- [ ] All node positions on 20px grid
- [ ] No vertical overlaps (check height + position)
- [ ] Minimum 200px Y-distance between nodes
- [ ] Columns properly left-aligned

### Group-Level Validation  
- [ ] Groups in same row have identical Y coordinate
- [ ] Horizontal spacing consistent (100px minimum)
- [ ] Vertical row spacing consistent (400px minimum)
- [ ] Group boundaries contain all nodes with padding

### Visual Validation
- [ ] No node overlaps when loaded in ComfyUI
- [ ] Groups visually balanced and aligned
- [ ] Clear flow from left to right
- [ ] Professional appearance at multiple zoom levels

## Common Mistakes to Avoid

### ❌ DON'T
- Place nodes without considering their height
- Use inconsistent spacing within same group
- Misalign groups in same row (even by 1px)
- Forget header clearance in groups
- Stack nodes too closely (under 200px Y-distance)

### ✅ DO
- Calculate spacing based on actual node heights
- Maintain consistent column widths
- Align all row groups by top edge exactly
- Leave proper header clearance (50px+)
- Use generous vertical spacing (200px+ minimum)

## Implementation Formula

### Node Y Position
```
node.y = group.y + header_clearance + (index * spacing)

Where:
- header_clearance = 50px minimum
- spacing = 200px minimum (adjust for node height)
- index = position in column (0, 1, 2...)
```

### Node X Position  
```
node.x = group.x + padding + (column * column_width)

Where:
- padding = 20px
- column = column index (0, 1, 2...)
- column_width = 400px+ (based on widest node)
```

## Version History
- v2.0 (2025-01-27): Complete rewrite with precise spacing standards
- v1.0 (2025-01-15): Initial layout guidelines

---
*This document is MANDATORY for all workflow generation and organization tasks*