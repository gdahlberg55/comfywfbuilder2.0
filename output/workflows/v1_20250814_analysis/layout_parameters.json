{
  "layout_strategy": {
    "type": "engineering_data_bus",
    "description": "Professional engineering drawing style with orthogonal routing and data bus architecture",
    "grid_snap": 20,
    "routing_style": "orthogonal_90_degree"
  },
  
  "calculated_spacing": {
    "horizontal_stage_gap": 1500,
    "vertical_parallel_gap": 600,
    "node_minimum_spacing": 80,
    "group_internal_padding": 100,
    "bus_lane_spacing": 200,
    "routing_channel_width": 40
  },
  
  "data_bus_lanes": {
    "horizontal_buses": [
      {
        "bus_id": "MODEL_BUS",
        "y_position": -2400,
        "width": 20,
        "color": "#FF6B6B",
        "purpose": "MODEL data routing",
        "breakout_points": [-1200, -600, 0, 600]
      },
      {
        "bus_id": "CLIP_BUS",
        "y_position": -2200,
        "width": 20,
        "color": "#4ECDC4",
        "purpose": "CLIP data routing",
        "breakout_points": [-600]
      },
      {
        "bus_id": "VAE_BUS",
        "y_position": -2000,
        "width": 20,
        "color": "#45B7D1",
        "purpose": "VAE data routing",
        "breakout_points": [0, 600, 1500]
      },
      {
        "bus_id": "IMAGE_BUS",
        "y_position": -1800,
        "width": 20,
        "color": "#96CEB4",
        "purpose": "IMAGE data routing",
        "breakout_points": [-600, 0, 1500]
      },
      {
        "bus_id": "CONDITIONING_BUS",
        "y_position": -1600,
        "width": 20,
        "color": "#FECA57",
        "purpose": "CONDITIONING data routing",
        "breakout_points": [0, 600]
      }
    ],
    
    "vertical_channels": [
      {"x": -1800, "purpose": "Input breakout channel"},
      {"x": -1200, "purpose": "Model processing channel"},
      {"x": -600, "purpose": "Conditioning channel"},
      {"x": 0, "purpose": "Sampling channel"},
      {"x": 600, "purpose": "First decode channel"},
      {"x": 1500, "purpose": "Frame processing channel"},
      {"x": 2500, "purpose": "Preview channel"},
      {"x": 3500, "purpose": "Final output channel"}
    ]
  },
  
  "stage_positions": {
    "input_stage": {
      "x_start": -2000,
      "x_end": -1600,
      "y_start": -2600,
      "y_end": -1400,
      "nodes": [97, 98, 99, 339],
      "title": "Input Loaders",
      "color": "#A8D5BA"
    },
    
    "model_processing_stage": {
      "x_start": -1400,
      "x_end": -400,
      "y_start": -2600,
      "y_end": -1800,
      "nodes": [95, 236, 48, 28, 84, 50, 54],
      "title": "Model Pipeline",
      "color": "#FFD3B5"
    },
    
    "conditioning_stage": {
      "x_start": -800,
      "x_end": -200,
      "y_start": -1700,
      "y_end": -1200,
      "nodes": [118, 14, 17, 16],
      "title": "Conditioning",
      "color": "#FFAAA5"
    },
    
    "image_preprocessing_stage": {
      "x_start": -1400,
      "x_end": -800,
      "y_start": -1400,
      "y_end": -800,
      "nodes": [112, 109, 96, 110],
      "title": "Image Processing",
      "color": "#B5E5CF"
    },
    
    "sampling_stage_pass1": {
      "x_start": -200,
      "x_end": 400,
      "y_start": -2600,
      "y_end": -2000,
      "nodes": [310, 313, 318, 319, 314, 311],
      "title": "First Pass Sampling",
      "color": "#E6E6FA"
    },
    
    "sampling_stage_pass2": {
      "x_start": -200,
      "x_end": 400,
      "y_start": -1900,
      "y_end": -1300,
      "nodes": [312, 316, 317],
      "title": "Second Pass Sampling",
      "color": "#DDA0DD"
    },
    
    "decode_stage": {
      "x_start": 500,
      "x_end": 800,
      "y_start": -2600,
      "y_end": -1300,
      "nodes": [322, 323, 320, 321],
      "title": "VAE Decode",
      "color": "#F0E68C"
    },
    
    "frame_processing_stage": {
      "x_start": 1200,
      "x_end": 2200,
      "y_start": -1700,
      "y_end": -900,
      "nodes": [276, 279, 290, 249, 281, 282, 293, 294, 291, 305, 358, 304, 306],
      "title": "Frame Processing",
      "color": "#FFE5B4"
    },
    
    "preview_stage": {
      "x_start": 2300,
      "x_end": 2900,
      "y_start": -2600,
      "y_end": -1800,
      "nodes": [38, 299, 277, 278, 301, 300],
      "title": "Preview Controls",
      "color": "#E6E6FA"
    },
    
    "final_output_stage": {
      "x_start": 3300,
      "x_end": 4300,
      "y_start": -2600,
      "y_end": -1000,
      "nodes": [221, 222, 349, 356, 359, 247],
      "title": "Final Output",
      "color": "#98FB98"
    }
  },
  
  "routing_strategy": {
    "connection_rules": [
      {
        "rule": "horizontal_first",
        "description": "Exit node horizontally to nearest vertical channel"
      },
      {
        "rule": "bus_lane_priority",
        "description": "Long connections use dedicated bus lanes"
      },
      {
        "rule": "vertical_drop",
        "description": "Drop vertically at destination x-coordinate"
      },
      {
        "rule": "channel_spacing",
        "description": "40px minimum between parallel routes in channels"
      },
      {
        "rule": "orthogonal_only",
        "description": "All routing at 90-degree angles, no diagonals"
      }
    ],
    
    "nested_channels": {
      "description": "Sub-channels within main vertical channels for clean separation",
      "implementation": [
        {
          "parent_channel": 0,
          "sub_channels": [-20, 0, 20],
          "purpose": "Separate overlapping connections in sampling zone"
        },
        {
          "parent_channel": 1500,
          "sub_channels": [-40, -20, 0, 20, 40],
          "purpose": "Handle complex frame processing connections"
        }
      ]
    }
  },
  
  "collision_zones": {
    "high_density_areas": [
      {
        "area": "sampling_intersection",
        "bounds": [-200, -2000, 400, -1300],
        "mitigation": "Use vertical separation and sub-channels"
      },
      {
        "area": "frame_processing_hub",
        "bounds": [1200, -1700, 2200, -900],
        "mitigation": "Staggered node placement with 150px spacing"
      }
    ]
  },
  
  "implementation_sequence": [
    {
      "step": 1,
      "action": "Position all nodes according to stage_positions"
    },
    {
      "step": 2,
      "action": "Create data bus lanes at specified Y positions"
    },
    {
      "step": 3,
      "action": "Route long connections through bus lanes"
    },
    {
      "step": 4,
      "action": "Implement vertical channels with nested sub-channels"
    },
    {
      "step": 5,
      "action": "Apply orthogonal routing for all connections"
    },
    {
      "step": 6,
      "action": "Add reroute nodes at all direction changes"
    },
    {
      "step": 7,
      "action": "Validate 40px minimum spacing between routes"
    }
  ]
}